{% extends "base.html" %}

{% block content %}
<div class="p-8 max-w-7xl mx-auto h-full overflow-y-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Biblioteca NorthWay</h1>
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <p class="text-gray-500">Acesse nossos materiais educativos e guias estratégicos.</p>
            {% if current_user.is_super_admin %}
            <a href="{{ url_for('master.master_library_new') }}"
                class="inline-flex items-center gap-2 bg-[#fa0102] text-white px-6 py-2.5 rounded-xl font-bold hover:bg-red-700 transition-all shadow-lg shadow-red-500/20">
                <i data-lucide="plus-circle" class="w-5 h-5"></i> Novo Material
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Section: Private Company Library (Legacy/Uploaded) -->
    {% if template_docs %}
    <div class="mb-12">
        <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
            <i data-lucide="folder-lock" class="text-purple-600"></i> Minha Biblioteca Privada ({{
            current_user.company.name }})
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for doc in template_docs %}
            <div
                class="group bg-white rounded-3xl p-2 shadow-sm hover:shadow-2xl transition-all duration-500 border border-gray-100 hover:border-purple-200">
                <div
                    class="relative aspect-video rounded-2xl bg-purple-50 overflow-hidden mb-6 group-hover:scale-[1.02] transition-transform duration-500 flex items-center justify-center border border-purple-100">
                    <div class="text-center relative z-10">
                        <i data-lucide="file-text" class="w-10 h-10 text-purple-500 mx-auto mb-3"></i>
                        <span
                            class="text-[10px] tracking-[0.2em] font-bold uppercase text-gray-500 block">Privado</span>
                    </div>
                </div>

                <div class="px-6 pb-6">
                    <div class="mb-4"><span
                            class="bg-purple-100 text-purple-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">Interno</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2 group-hover:text-purple-700 transition-colors">{{
                        doc.name }}</h3>
                    <a href="{{ url_for('docs.view_document', id=doc.id) }}"
                        class="inline-flex items-center text-sm font-bold text-gray-900 group-hover:text-purple-700 transition-colors mt-4">
                        Ler Documento <i data-lucide="arrow-right"
                            class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"></i>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Section 1: Apresentações & Comercial -->
    <div class="mb-12">
        <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
            <i data-lucide="monitor-play" class="text-[#fa0102]"></i> Apresentações & Comercial
        </h2>
        {% set commercial_books = [] %}
        {% for book in system_books %}
        {% if book.category in ['Vendas', 'Institucional', 'Apresentação'] %}
        {% if commercial_books.append(book) %}{% endif %}
        {% endif %}
        {% endfor %}

        {% if commercial_books %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for book in commercial_books %}
            <div
                class="group bg-white rounded-3xl p-2 shadow-sm hover:shadow-2xl transition-all duration-500 border border-gray-100 hover:border-red-100 h-full flex flex-col">
                <div
                    class="relative aspect-video rounded-2xl bg-[#0f0f0f] overflow-hidden mb-6 group-hover:scale-[1.02] transition-transform duration-500 border border-gray-800">
                    {% if book.cover_image %}
                    <img src="{{ book.cover_image }}" class="absolute inset-0 w-full h-full object-cover opacity-60">
                    {% endif %}
                    <div
                        class="absolute inset-0 flex flex-col items-center justify-center text-white p-4 text-center z-10">
                        {% if not book.cover_image %}
                        <i data-lucide="bar-chart-2" class="w-10 h-10 text-[#fa0102] mx-auto mb-3"></i>
                        {% endif %}
                        <h4
                            class="text-lg font-black font-display tracking-tight uppercase leading-tight drop-shadow-lg">
                            {{ book.title }}
                        </h4>
                    </div>
                    <!-- Carbon fibre pattern overlay if institutional -->
                    {% if book.category == 'Institucional' %}
                    <div
                        class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-30">
                    </div>
                    {% endif %}
                </div>

                <div class="px-6 pb-6 flex-1 flex flex-col">
                    <div class="mb-4">
                        <span
                            class="bg-red-50 text-[#fa0102] text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">{{
                            book.category }}</span>
                    </div>
                    <h3
                        class="text-xl font-bold text-gray-900 mb-2 group-hover:text-[#fa0102] transition-colors line-clamp-2">
                        {{ book.title }}
                    </h3>
                    <p class="text-sm text-gray-500 mb-4 line-clamp-2">{{ book.description or '' }}</p>

                    <div class="mt-auto flex items-center justify-between">
                        <a href="{{ url_for(book.route_name) if book.route_name else url_for('docs.view_book', id=book.id) }}"
                            class="inline-flex items-center text-sm font-bold text-gray-900 group-hover:text-[#fa0102] transition-colors">
                            Acessar Material <i data-lucide="arrow-right"
                                class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"></i>
                        </a>

                        {% if current_user.is_super_admin %}
                        <div class="flex items-center gap-2">
                            <a href="{{ url_for('master.master_library_edit', id=book.id) }}"
                                class="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all"
                                title="Editar">
                                <i data-lucide="edit-3" class="w-4 h-4"></i>
                            </a>
                            <form action="{{ url_for('master.master_library_delete', id=book.id) }}" method="POST"
                                onsubmit="return confirm('Excluir este material permanentemente?');">
                                <button type="submit"
                                    class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all"
                                    title="Excluir">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-400 italic">Nenhum material disponível nesta seção.</p>
        {% endif %}
    </div>

    <!-- Section 2: Processos & Treinamento -->
    <div>
        <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
            <i data-lucide="book-open" class="text-gray-400"></i> Processos & Treinamento
        </h2>

        {% set training_books = [] %}
        {% for book in system_books %}
        {% if book.category not in ['Vendas', 'Institucional', 'Apresentação'] %}
        {% if training_books.append(book) %}{% endif %}
        {% endif %}
        {% endfor %}

        {% if training_books %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for book in training_books %}
            <div
                class="group bg-white rounded-3xl p-2 shadow-sm hover:shadow-2xl transition-all duration-500 border border-gray-100 hover:border-gray-300 h-full flex flex-col">
                <div
                    class="relative aspect-video rounded-2xl bg-gray-50 overflow-hidden mb-6 group-hover:scale-[1.02] transition-transform duration-500 flex items-center justify-center border border-gray-100">
                    <!-- Special styling for 'Treinamento' aka Academia -->
                    {% if book.category == 'Treinamento' %}
                    <div class="absolute inset-0 bg-[#0a0a0a]"></div>
                    <div class="text-center relative z-10">
                        <i data-lucide="graduation-cap" class="w-10 h-10 text-blue-500 mx-auto mb-3"></i>
                        <span
                            class="text-[10px] tracking-[0.2em] font-bold uppercase text-gray-500 block">Academia</span>
                    </div>
                    {% else %}
                    <div class="text-center p-4">
                        <i data-lucide="book" class="w-10 h-10 text-gray-400 mx-auto mb-3"></i>
                        <span class="text-[10px] tracking-[0.2em] font-bold uppercase text-gray-500 block">{{
                            book.category }}</span>
                    </div>
                    {% endif %}

                    {% if book.cover_image %}
                    <img src="{{ book.cover_image }}"
                        class="absolute inset-0 w-full h-full object-cover opacity-60 mix-blend-overlay">
                    {% endif %}
                </div>

                <div class="px-6 pb-6 flex-1 flex flex-col">
                    <div class="mb-4">
                        {% if book.category == 'Treinamento' %}
                        <span
                            class="bg-blue-900/10 text-blue-600 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">Treinamento</span>
                        {% else %}
                        <span
                            class="bg-gray-100 text-gray-600 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">{{
                            book.category }}</span>
                        {% endif %}
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">{{ book.title }}</h3>
                    <p class="text-sm text-gray-500 mb-4 line-clamp-2">{{ book.description or '' }}</p>

                    <div class="mt-auto flex items-center justify-between">
                        <a href="{{ url_for(book.route_name) if book.route_name else url_for('docs.view_book', id=book.id) }}"
                            class="inline-flex items-center text-sm font-bold text-gray-900 group-hover:text-purple-600 transition-colors">
                            Ler Material <i data-lucide="arrow-right"
                                class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"></i>
                        </a>

                        {% if current_user.is_super_admin %}
                        <div class="flex items-center gap-2">
                            <a href="{{ url_for('master.master_library_edit', id=book.id) }}"
                                class="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all"
                                title="Editar">
                                <i data-lucide="edit-3" class="w-4 h-4"></i>
                            </a>
                            <form action="{{ url_for('master.master_library_delete', id=book.id) }}" method="POST"
                                onsubmit="return confirm('Excluir este material permanentemente?');">
                                <button type="submit"
                                    class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all"
                                    title="Excluir">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-400 italic">Nenhum material disponível nesta seção.</p>
        {% endif %}
    </div>

</div>
{% endblock %}