<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="nw-popup">
        <!-- HEADER -->
        <div class="nw-popup-header">
            <div class="nw-header-row">
                <div class="nw-logo-icon-small">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M13 3L21 11M21 11L13 19M21 11H3"></path>
                    </svg>
                </div>
                <span class="nw-header-title">NorthWay Assistant</span>
                <div class="nw-connection-status offline" title="Desconectado"></div>
            </div>

            <!-- Navbar (Only visible when logged in) -->
            <div id="nw-navbar" class="nw-navbar hidden">
                <button class="nw-nav-btn active" data-tab="broadcast">Disparo</button>
                <button class="nw-nav-btn" data-tab="settings">Config</button>
                <button class="nw-nav-btn" data-tab="profile">Perfil</button>
            </div>
        </div>

        <!-- AUTH VIEW (Login) -->
        <div id="nw-view-auth">
            <div class="nw-hero">
                <h1>Acesse sua <br><span>Opera√ß√£o</span></h1>
                <p>ZapWay Extension v2.5</p>
            </div>

            <div id="nw-login-form" class="nw-auth-card">
                <div id="nw-error-msg" class="nw-error-box hidden"></div>
                <div class="nw-input-group">
                    <input type="email" id="nw-email" placeholder="E-mail Corporativo" value="admin@northway.com">
                </div>
                <div class="nw-input-group">
                    <input type="password" id="nw-password" placeholder="Senha de Acesso" value="123456">
                </div>
                <button id="nw-btn-login" class="nw-btn primary">Conectar</button>
            </div>
        </div>

        <!-- BROADCAST VIEW (Main) -->
        <div id="nw-view-broadcast" class="nw-view hidden">

            <!-- Step 1: Target Selection -->
            <div class="nw-section">
                <label class="nw-label-caps">1. Selecionar Alvos</label>
                <div class="nw-field-row">
                    <select id="nw-funnel-select" class="nw-select">
                        <option value="">Selecione um Funil...</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="nw-field-row">
                    <select id="nw-stage-select" class="nw-select" disabled>
                        <option value="">Etapa...</option>
                    </select>
                </div>
                <div class="nw-info-box hidden" id="nw-target-info">
                    <span id="nw-target-count">0</span> contatos encontrados
                </div>
            </div>

            <!-- Step 2: Message -->
            <div class="nw-section">
                <div class="nw-row-between">
                    <label class="nw-label-caps">2. Mensagem</label>
                    <div class="nw-toggle-group">
                        <label class="nw-toggle-label">Varia√ß√µes</label>
                        <input type="checkbox" id="nw-use-variants" class="nw-toggle">
                    </div>
                </div>

                <textarea id="nw-msg-input" class="nw-textarea"
                    placeholder="Ol√° {{primeiro_nome}}, tudo bem?"></textarea>
                <div class="nw-tags-list">
                    <span class="nw-tag" data-var="{{primeiro_nome}}">Nome</span>
                    <span class="nw-tag" data-var="{{empresa}}">Empresa</span>
                </div>
            </div>

            <!-- Step 3: Attachments -->
            <div class="nw-section">
                <label class="nw-label-caps">3. Anexos (Opcional)</label>

                <div id="nw-attachments-list" class="nw-attachments-list">
                    <!-- Items injected here -->
                </div>

                <div class="nw-upload-area" id="nw-upload-area">
                    <input type="file" id="nw-file-input" multiple style="display: none;">
                    <span class="nw-upload-icon">+</span>
                    <span>Adicionar Arquivo</span>
                </div>
            </div>

            <!-- Step 4: Interval & Action -->
            <div class="nw-section">
                <div class="nw-field-row">
                    <div class="nw-field">
                        <label>Min (s)</label>
                        <input type="number" id="nw-delay-min" value="20" class="nw-input-sm">
                    </div>
                    <div class="nw-field">
                        <label>M√°x (s)</label>
                        <input type="number" id="nw-delay-max" value="60" class="nw-input-sm">
                    </div>
                </div>
            </div>

            <button id="nw-btn-start" class="nw-btn primary big">
                INICIAR DISPARO ASSISTIDO üöÄ
            </button>
        </div>

        <!-- SETTINGS VIEW -->
        <div id="nw-view-settings" class="nw-view hidden">
            <div class="nw-card-flat">
                <label class="nw-label-caps">Limites de Seguran√ßa</label>
                <div class="nw-field">
                    <label>Limite Di√°rio</label>
                    <input type="number" id="nw-setting-limit" value="100">
                </div>
                <div class="nw-info-text">
                    O disparo assistido pausa automaticamente ao atingir este limite para proteger seu n√∫mero.
                </div>
            </div>
            <button id="nw-btn-save-settings" class="nw-btn secondary">Salvar Configura√ß√µes</button>
        </div>

        <!-- PROFILE VIEW -->
        <div id="nw-view-profile" class="nw-view hidden">
            <div class="nw-user-card">
                <div class="nw-user-avatar">
                    <img id="nw-user-img" src="" class="hidden">
                    <span id="nw-user-initials">AD</span>
                </div>
                <div class="nw-user-info">
                    <strong id="nw-user-name">Usu√°rio</strong>
                    <span id="nw-user-email">email@northway.com</span>
                </div>
            </div>

            <a href="https://crm.northwaycompany.com.br/home" target="_blank" class="nw-btn secondary">
                Ir para o CRM
            </a>

            <button id="nw-btn-logout" class="nw-btn logout">
                Desconectar
            </button>
        </div>

        <!-- FOOTER -->
        <div class="nw-popup-footer">
            <span class="nw-version">v2.5.0</span>
            <div class="nw-footer-stats hidden" id="nw-footer-stats">
                Enviados hoje: <span id="nw-today-count">0</span>
            </div>
        </div>
    </div>

    <script src="popup.js"></script>
</body>

</html>